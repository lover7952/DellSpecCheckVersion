dim HBAVer, Datavalue[5000], Effdata[5000], EffOffset, ACS[300], IOCS[300], DSTSUP, DMSUP, SSSUP, SRSUP, MandatoryCmdVal[5]
dim CMPSUP, RESREGSUP, RESREPSUP, RESACQSUP, RESRELSUP, WZSUP, WUSUP, LogFile, FWID, idata[100],RBC, CriticalWarning[5], IDFYValue, IDFYValue1
dim FWSlotOffset, FWSlotdata[100], AFIRun, AFIGo, FRS[10], Data[30], MPSIMIN, LBADS[20],SmartOffset, Smartdata[1000], SptChk[20]
dim NN, CurrentNCQA, CurrentNSQA, ASPMSUP, ASPM, CurrentAPSTE, ONCS, SE, CE, OverES, BlockES,CryptoES, TempInfo, CurrentSHCW
dim CurrentDN, Resersupport, CurrentEHM, CurrentHSIZE, RPMBS, BootPar, NSMgt, HCTM, CurrentNOPPME, ePPIDVal[100], TempTest, SEDSpt, ASPMSpt
dim DellSmartSpec[10],DellTCGSpec[5],DUTTCGSpec[10], DellNVMCmdSetM[10],DellNVMCmdSetO[10],DellFWDownL, ePPIDEnd, ePPIDChk, ePPIDChk2
dim DellNSSup,DellNSDefault,DellASPMSUP, DellASPMDefault, DellAPSTSUP, DellAPSTDefault, DellFPSUP, DellFPDefault,TempVal[5]
dim DellCESUP, DellCEDefault, DellSESUP, DellSEDefault, DellBESSUP, DellBESDefault, DellCESSUP, DellCESDefault,MT2Val,MTChk
dim DellOSSUP, DellOSDefault, DellTTSUP, DellTTDefault, DellAECSUP, DellAECDefault, DellVWCSUP, DellVWCDefault,MT1Val,MT1Current,MT2Current
dim DellEDPSUP, DellEDPDefault, DellResSUP, DellResDefault, DellHMBSUP, DellHMBDefault, DellRPMBSUP, DellRPMBDefault, ChkPers
dim DellBPSUP, DellBPDefault, DellNMSUP, DellNMDefault, DellHCTMSUP, DellHCTMDefault, DellNOPSSUP, DellNOPSDefault, MTResult[5]
dim DellPersistence[20], DellSmartSup, DellMPSMIN, DellFLBAS, ErrCnt, DellTCGBlockSID, DellSQNum, DellCQNum, DellPSIDSup, DellFeaM
dim ASPML12Spt, ASPML11Spt, ASPML1Spt, HMB, NOPSSpt, LevelASPMSpt, ASPML12En, ASPMEn, DellSEDSpt, ASPML11En, E2EInfo, UnderThre, OverThre

include "tcg_psidspt_a.ens"
include "DellSpecInfo_cfg.txt"

cls
logoff
echo off
upd on
timer3=0
ErrCnt=0
prns "=============================(Check Dell Spec V1.4.5 Licensed By ULINK)============================="
script; ver; hbaname; devname; date;
prns "=============================(Check Dell Spec V1.4.5 Licensed By ULINK)============================="
prnsr "Script Start "; time; 
prns ""
prns "*** Check Dell Spec V1.4.5 (Copyright @ 2018 by ULINK Technology, All Right Reserved)***"
prns ""
prns "\n  Set the Saved Spec value based on the inputs or the DellSpecInfo_CFG.TXT"


prns ""
prns ""
prns "* Test Case 1: Dell IDFY Checking"
prns "* Test Case 2: Dell SMART Attribute Table"
prns "* Test Case 3: Dell Security Support"
prns "* Test Case 4: Dell NVMe Command Set (Mandatory)"
prns "* Test Case 5: Dell NVMe Command Set (Optional)"
prns "* Test Case 6: Dell Firmware Slot Information"
prns "* Test Case 7: Dell NVMe Feature Requirements Table"
prns "* Test Case 8: Dell Feature Persistence Table"
prns "* Test Case 9: Dell NVMe Controller Registers Settings"
prns "* Test Case 10: Dell Test Persistence Command Status (Save=1)"
prns "* Test Case 11: Dell HD-DITM Temperature Settings (+-2C)"
prns ""
prns ""
prnf " Power Cycle..."
Pwoff
wait 1000
pwon
wait 1000
pinit
nvm_idfy
prns ""
prns ""
prnf "\n Test Case 1: Dell IDFY Checking"
prnf "\n                                       Value                     Dell Spec         Result"
prnf "\n ==========================================================================================="
nvm_cmd_nsid = 0
nvm_idfy
copy "readA","read"
rpoint=3072; rr i1;
i = 0
for (rpoint=3072;rpoint<(3072+32);rpoint+=1)
   rr i1
   ePPIDVal[i] = i1
   i+=1
endfor
ePPIDEnd = i
i = 0
ePPIDChk = 0
prns ""
prnf "\n  DELL ePPID                 : "
do
   if (ePPIDVal[i] == 32)
      prnf "*"
   elseif (ePPIDVal[i] == 0)
      prnf "_"
   else
      prnf "%C", ePPIDVal[i]
   endif
   i+=1
until (i == ePPIDEnd)
i = 0
do 
   if (ePPIDVal[i] == 32)
      ePPIDChk2 = i
      goto ePPIDCheckEnd
   endif
   i+=1
until (i == ePPIDEnd)
ePPIDCheckEnd:
prnf "  ASCII Characters"

if (ePPIDVal[ePPIDChk] == 0)
   prnf "  Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: Devive Not Support Dell Spec"
elseif (ePPIDVal[ePPIDChk2-3] == 88 || ePPIDVal[ePPIDChk2-3] == 65 )
   prnf "  Pass"
else
   prnf "  Fail***"
   prnf "\n      +++++ Fail: Last 3rd Character should be 'X' or 'A'"
   ErrCnt+=1
endif
prnf "\n  Note: '*' stands for space character (20h), '_' stands for null character (00h)"
prnf "\n"
prnf "\n"

prnf "\n  DELL Nominal Form Factor   : "
rrw i1
if (i1==0) prnf "Nominal form factor not reported"; prnf " (%4.4Xh)",i1 ; prnf "            Info"
   elseif (i1 == 1) prnf "2.5 inch nominal form factor"; prnf " (%4.4Xh)",i1 ; prnf "                Info"
   elseif (i1 == 2) prnf "M.2"; prnf " (%4.4Xh)",i1 ; prnf "                                         Info"
   elseif (i1 == 3) prnf "HHHL"; prnf " (%4.4Xh)",i1 ; prnf "                                        Info"
endif
prnf "\n  DELL Device Catogory       : "
rpoint=3106
rrw i1
i=i1&3h
if (i == 0) prnf "Mainstream"
   elseif (i == 1) prnf "Value"
   elseif (i == 2) prnf "Performance"
   elseif (i == 3) prnf "Performance Plus"
endif
i=(i1>>13)&3h
if (i == 0) prnf ", Storage Device"; prnf " (%4.4Xh)",i1; prnf "                  Info"
   elseif (i == 1) prnf ", Fast Memory Accelerator (2 device)"; prnf " (%4.4Xh)",i1; prnf " Info"
endif

prnf "\n  DELL Unique Features       : "
rpoint=3108
rrw i1
if (i1&8000h)
   if (i1&1)
      prnf "SCP supported                                       Pall"
   else 
      prnf "SCP not supported                                   Fail***"
      ErrCnt+=1
   endif
else 
   prnf "Word 3108; Bit 15=0, SCP not supported"
   prnf " (%4.4Xh)      Fail***",i1
   ErrCnt+=1
endif

prns ""
prns ""
prnf "\n Test Case 2: Dell SMART Attribute Table"
prnf "\n                                                     Value         Dell Spec       Result   "
prnf "\n ==========================================================================================="
NVM_CMD_NSID = 0ffffffffh
nvm_getlog 0cah,100h
if (code)
   prnf "\n  Support Dell SMART Get Log command (0CAh)        :   No"
   i0 = 0
else
   prnf "\n  Support Dell SMART Get Log command (0CAh)        :  Yes"
   i0 = 1
endif
if (DellSmartSup == 0)
   prnf "             No"
else
   prnf "             Yes"
endif
if (DellSmartSup == i0)
   prnf "          Pass"
else
   prnf "          Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: Not Support SMART Get Log Command"
   prnf "\n"
   prnf "\n"
endif
if (i0 == 0)
   goto CaseExit
endif
copy "ReadA","Read"
g0 = 0
SmartOffset = 0
do
   RU "ReadA", SmartOffset, Smartdata[g0]
   SmartOffset+=1
   g0+=1
until (SmartOffset == 12)
RBC = (Smartdata[11]<<24)+(Smartdata[10]<<16)+(Smartdata[9]<<8)+Smartdata[8]
prnf "\n  Re-Assigned Sector Count                         : %3d%%",Smartdata[0];
if (DellSmartSpec[0] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[0]
   if (Smartdata[0] < DellSmartSpec[0])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Program Fail Count (Worst Case Component)        : %3d%%",Smartdata[1]
if (DellSmartSpec[1] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[1]
   if (Smartdata[1] < DellSmartSpec[1])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Program Fail Count (SSD Total)                   : %3d%%",Smartdata[2]
if (DellSmartSpec[2] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[2]
   if (Smartdata[2] < DellSmartSpec[2])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Erase Fail Count (Worst Case Component)          : %3d%%",Smartdata[3]
if (DellSmartSpec[3] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[3]
   if (Smartdata[3] < DellSmartSpec[3])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Erase Fail Count (SSD Total)                     : %3d%%",Smartdata[4]
if (DellSmartSpec[1] == 4)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[4]
   if (Smartdata[4] < DellSmartSpec[4])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Wear Leveling Count                              : %3d%%",Smartdata[5]
if (DellSmartSpec[5] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[5]
   if (Smartdata[5] < DellSmartSpec[5])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Used Reserved Block Count (Worst Case Component) : %3d%%",Smartdata[6]
if (DellSmartSpec[6] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[6]
   if (Smartdata[6] < DellSmartSpec[6])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Used Reserved Block Count (SSD Total)            : %3d%%",Smartdata[7]
if (DellSmartSpec[7] == 0)
   prnf "             NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[7]
   if (Smartdata[7] < DellSmartSpec[7])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
prnf "\n  Reserved Block Count (SSD Total)                 : %8.8X",RBC
if (DellSmartSpec[8] == 0)
   prnf "         NA"; prnf "           NA"
else
   prnf "             %02d%%",DellSmartSpec[8]
   if (Smartdata[8] < DellSmartSpec[8])
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The device Value is higher than Dell Spec Value"
      prnf "\n"
      prnf "\n"
   endif
endif
CaseExit:
prns ""
prns ""
prnf "\n Test Case 3: Dell Security Support"
prnf "\n                                                             Value         Dell Spec       Result   "
prnf "\n ==================================================================================================="
NVM_CMD_NSID = 1;NVM_Idfy_Ctrlr
TCG_ChkSpt
if (TCG_SPT) 
   prnf "\n  TCG Security supported (Word: 256; Bit 0=1)              :  Yes"
   DUTTCGSpec[0] = 1
else
   prnf "\n  TCG Security not supported (Word: 256; Bit 0=0)          :   No"
   DUTTCGSpec[0] = 0
endif
if (DellTCGSpec[0] == 0)
   prnf "              No"
else
   prnf "             Yes"
endif
if (DellTCGSpec[0] == DUTTCGSpec[0])
   prnf "          Pass"
else
   prnf "          Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
   prnf "\n"
   prnf "\n"
endif
tcg_level0_discovery
for (i=0;i<TCG_FEATURE_NUM;i+=1)
   TCG_FTCODE_OFFSET i,i0,i1
   if (i1==0200h)
      prnf "\n  TCG SSC supports (Level 0 Discovery Feature Code:0200h)  :  Opal 1.0     Opal/Pyrite     Pass"
   elseif (i1==0203h)
      prnf "\n  TCG SSC supports (Level 0 Discovery Feature Code:0203h)  :  Opal 2.01    Opal/Pyrite     Pass"  
   elseif (i1==0302h)
      prnf "\n  TCG SSC supports (Level 0 Discovery Feature Code:0302h)  :  Pyrite 1.0   Opal/Pyrite     Pass"
   elseif (i1==0303h)
      prnf "\n  TCG SSC supports (Level 0 Discovery Feature Code:0303h)  :  Pyrite 2.0   Opal/Pyrite     Pass"
   endif
endfor
if (bPsid == 1)
   prnf "\n  PSID support (Authority UID: 00000009-0001FF01)          :  Yes"
else
   prnf "\n  PSID support (Authority UID: 00000009-0001FF01)          :   No"
endif
if (DellPSIDSup == 0)
   prnf "              No"
else
   prnf "             Yes"
endif
if (DellPSIDSup == bPsid)
   prnf "          Pass"
else
   prnf "          Fail***"
   ErrCnt+=1
endif

if (TCG_BS_DESC == 1)
   prnf "\n  Block SID support (Level 0 Discovery Feature Code:0402h) :  Yes"
else
   prnf "\n  Block SID support (Level 0 Discovery Feature Code:0402h) :   No"
endif
if (DellTCGBlockSID == 0)
   prnf "              No"
else
   prnf "             Yes"
endif
if (DellTCGBlockSID == TCG_BS_DESC)
   prnf "          Pass"
else
   prnf "          Fail***"
   ErrCnt+=1
endif

tcg_level0_discovery
SEDSpt = tcg_lock_encrypt
if (SEDSpt == 1)
   prnf "\n  SED support (Level 0 Discovery Feature Code:0002h)       :  Yes"
else
   prnf "\n  SED support (Level 0 Discovery Feature Code:0002h)       :   No"
endif
if (DellSEDSpt == 0)
   prnf "              No"
elseif (DellSEDSpt == 1)
   prnf "             Yes"
else
   prnf "              NA"
endif
prnf "          Info"


prns ""
prns ""
prnf "\n Test Case 4: Dell NVMe Command Set (Mandatory)"
prnf "\n                                                     Value         Dell Spec       Result   "
prnf "\n ==========================================================================================="
IDFYValue = 520
IDFYValue1 = 256
NVM_CMD_NSID = 0
NVM_GETLOG_CMDEFFECT
g0 = 0
EffOffset = 0
do
   RU "ReadA", EffOffset, Effdata[g0]
   EffOffset+=1
   g0+=1
until (EffOffset == 2048)
i = 0
j = 0
do
   ACS[i] = (Effdata[3+j]<<24)+(Effdata[2+j]<<16)+(Effdata[1+j]<<8)+Effdata[0+j]
   IOCS[i] = (Effdata[1027+j]<<24)+(Effdata[1026+j]<<16)+(Effdata[1025+j]<<8)+Effdata[1024+j]
   i+=1
   j+=4
until (i == 256)
nvm_idfy
RU "ReadA", IDFYValue, MandatoryCmdVal[0]
RU "ReadA", IDFYValue1, MandatoryCmdVal[1]
DMSUP = (MandatoryCmdVal[0]>>2)&1
SSSUP = ACS[129]&1
SRSUP = ACS[130]&1
DSTSUP = (MandatoryCmdVal[1]>>4)&1
CMPSUP = (MandatoryCmdVal[0]>>0)&1
WZSUP = (MandatoryCmdVal[0]>>3)&1
WUSUP = (MandatoryCmdVal[0]>>1)&1
if (DMSUP == 1)
   prnf "\n  Support Dataset Management (Byte: %d;", IDFYValue; prnf " Bit 2=%d)", DMSUP; prnf "  :  Yes"
else
   prnf "\n  Support Dataset Management (Byte: %d;", IDFYValue; prnf " Bit 2=%d)", DMSUP; prnf "  :   No"
endif
if (DellNVMCmdSetM[0] == 0)
   prnf "              No"
   if (DellNVMCmdSetM[0] == DMSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[0] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetM[0] == DMSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[0] == 2)
   prnf "             NA"; prnf "           NA"
endif

if (SSSUP == 1)
   prnf "\n  Support Security Send (Byte: %d;", IDFYValue1; prnf " Bit 0=%d)", SSSUP; prnf "       :  Yes"
else
   prnf "\n  Support Security Send (Byte: %d;", IDFYValue1; prnf " Bit 0=%d)", SSSUP; prnf "       :   No"
endif
if (DellNVMCmdSetM[1] == 0)
   prnf "              No"
   if (DellNVMCmdSetM[1] == SSSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[1] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetM[1] == SSSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[1] == 2)
   prnf "             NA"; prnf "           NA"
endif

if (SRSUP == 1)
   prnf "\n  Support Security Receive (Byte: %d;", IDFYValue1; prnf " Bit 0=%d)", SRSUP; prnf "    :  Yes"
else
   prnf "\n  Support Security Receive (Byte: %d;", IDFYValue1; prnf " Bit 0=%d)", SRSUP; prnf "    :   No"
endif
if (DellNVMCmdSetM[2] == 0)
   prnf "              No"
   if (DellNVMCmdSetM[2] == SRSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[2] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetM[2] == SRSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[2] == 2)
   prnf "             NA"; prnf "           NA"
endif

if (DSTSUP == 1)
   prnf "\n  Support Device Self-Test (Byte: %d;", IDFYValue1; prnf " Bit 4=%d)", DSTSUP; prnf "    :  Yes"
else
   prnf "\n  Support Device Self-Test (Byte: %d;", IDFYValue1; prnf " Bit 4=%d)", DSTSUP; prnf "    :   No"
endif
if (DellNVMCmdSetM[3] == 0)
   prnf "              No"
   if (DellNVMCmdSetM[3] == DSTSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[3] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetM[3] == DSTSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[3] == 2)
   prnf "             NA"; prnf "           NA"
endif

if (CMPSUP == 1)
   prnf "\n  Support Compare (Byte: %d;", IDFYValue; prnf " Bit 0=%d)", CMPSUP; prnf "             :  Yes"
else
   prnf "\n  Support Compare (Byte: %d;", IDFYValue; prnf " Bit 0=%d)", CMPSUP; prnf "              :  No"
endif
if (DellNVMCmdSetM[4] == 0)
   prnf "              No"
   if (DellNVMCmdSetM[4] == CMPSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[4] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetM[4] == CMPSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetM[4] == 2)
   prnf "             NA"; prnf "           NA"
endif

prns ""
prns ""
prnf "\n Test Case 5: Dell NVMe Command Set (Optional)"
prnf "\n                                                     Value         Dell Spec       Result   "
prnf "\n ==========================================================================================="
RESREGSUP = IOCS[13]&1
RESREPSUP = IOCS[14]&1
RESACQSUP = IOCS[17]&1
RESRELSUP = IOCS[21]&1
if (RESREGSUP == 1)
   prnf "\n  Support Reservation Register (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESREGSUP; prnf ":  Yes"
else
   prnf "\n  Support Reservation Register (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESREGSUP; prnf ":   No"
endif
if (DellNVMCmdSetO[0] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[0] == RESREGSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[0] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[0] == RESREGSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[0] == 2)
   prnf "           Optional"; prnf "       Pass"
endif

if (RESREPSUP == 1)
   prnf "\n  Support Reservation Report (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESREPSUP; prnf "  :  Yes"
else
   prnf "\n  Support Reservation Report (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESREPSUP; prnf "  :   No"
endif
if (DellNVMCmdSetO[1] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[1] == RESREPSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[1] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[1] == RESREPSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[1] == 2)
   prnf "           Optional"; prnf "       Pass"
endif

if (RESACQSUP == 1)
   prnf "\n  Support Reservation Acquire (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESACQSUP; prnf " :  Yes"
else
   prnf "\n  Support Reservation Acquire (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESACQSUP; prnf " :   No"
endif
if (DellNVMCmdSetO[2] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[2] == RESACQSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[2] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[2] == RESACQSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[2] == 2)
   prnf "           Optional"; prnf "       Pass"
endif

if (RESRELSUP == 1)
   prnf "\n  Support Reservation Release (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESRELSUP; prnf " :  Yes"
else
   prnf "\n  Support Reservation Release (Byte: %d;", IDFYValue; prnf " Bit 5=%d)", RESRELSUP; prnf " :   No"
endif
if (DellNVMCmdSetO[3] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[3] == RESRELSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[3] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[3] == RESRELSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[3] == 2)
   prnf "           Optional"; prnf "       Pass"
endif

if (WZSUP == 1)
   prnf "\n  Support Write Zeroes (Byte: %d;", IDFYValue; prnf " Bit 3=%d)", WZSUP; prnf "        :  Yes"
else
   prnf "\n  Support Write Zeroes (Byte: %d;", IDFYValue; prnf " Bit 3=%d)", WZSUP; prnf "        :   No"
endif
if (DellNVMCmdSetO[4] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[4] == WZSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[4] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[4] == WZSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[4] == 2)
   prnf "           Optional"; prnf "       Pass"
endif

if (WUSUP == 1)
   prnf "\n  Support Write Uncorrectable (Byte: %d;", IDFYValue; prnf " Bit 1=%d)", WUSUP; prnf " :  Yes"
else
   prnf "\n  Support Write Uncorrectable (Byte: %d;", IDFYValue; prnf " Bit 1=%d)", WUSUP; prnf " :   No"
endif
if (DellNVMCmdSetO[5] == 0)
   prnf "              No"
   if (DellNVMCmdSetO[5] == WUSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[5] == 1)
   prnf "             Yes"
   if (DellNVMCmdSetO[5] == WUSUP)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellNVMCmdSetO[5] == 2)
   prnf "           Optional"; prnf "       Pass"
endif
prns ""
prns ""

//FWSlot
NVM_GETLOG_FWSLOT
g0 = 0
FWSlotOffset = 0
do
   RU "ReadA", FWSlotOffset, FWSlotdata[g0]
   FWSlotOffset+=1
   g0+=1
until (FWSlotOffset == 64)

AFIRun = FWSlotdata[0]>>0&3
AFIGo = FWSlotdata[0]>>4&3
FWID = ACS[17]&1
i = 1
j = 0
do
   FRS[i] = (FWSlotdata[15+j]<<56)+(FWSlotdata[14+j]<<48)+(FWSlotdata[13+j]<<40)+(FWSlotdata[12+j]<<32)+(FWSlotdata[11+j]<<24)+(FWSlotdata[10+j]<<16)+(FWSlotdata[9+j]<<8)+FWSlotdata[8+j]
      i+=1
      j+=8
until (i==8)

prns "\n Test Case 6: Dell Firmware Slot Information"
prnf "\n                                                     Value         Dell Spec       Result   "
prnf "\n ==========================================================================================="
if (FWID == 1)
   prnf "\n  Support FW Image Download (Byte: 256; Bit 2=1)   :  Yes"
else
   prnf "\n  Support FW Image Download (Byte: 256; Bit 2=0)   :   No"
endif
if (DellFWDownL == 0)
   prnf "              No"
   if (DellFWDownL == FWID)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellFWDownL == 1)
   prnf "             Yes"
   if (DellFWDownL == FWID)
      prnf "          Pass"
   else
      prnf "          Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device not follow Dell Spec Feature"
      prnf "\n"
      prnf "\n"
   endif
elseif (DellFWDownL == 2)
   prnf "             NA"; prnf "           NA"
endif
prns "\n     Active FW info"
prnf "\n              06:04                       %d", AFIGo; prns "  (FW slot going to be activated)"
prnf "\n              02:00                       %d", AFIRun; prns "  (FW slot running)"
i = 1
j = 0
do       
   prnf "\n     FW Revision for Slot %d",i;
   if ( FRS[i] == 0 )
      prns "               0"
      i+=1
      j+=8
   else
      prnf "               %c", FWSlotdata[8+j];prnf "%c", FWSlotdata[9+j];prnf "%c", FWSlotdata[10+j];prnf "%c", FWSlotdata[11+j];prnf "%c", FWSlotdata[12+j]
      prnf "%c", FWSlotdata[13+j];prnf "%c", FWSlotdata[14+j];;prnf "%c", FWSlotdata[15+j]
      i+=1
      j+=8
   endif
until (i==8)
prns "\n"
prns "\n"

INNVMHBA 8,HBAVer
NVM_Idfy_Ctrlr
i = 516
do
   RU "ReadA",i,Datavalue[i];
   i+=1
until (i == 520)
prns "\n Test Case 7: Dell NVMe Feature Requirements Table"
prnf "\n                                                     Value    Default    Dell Spec   Default   Result   "
prnf "\n ======================================================================================================="
NN = (Datavalue[519]<<24)+(Datavalue[518]<<16)+(Datavalue[517]<<8)+Datavalue[516]
if (NN == 0)
   prnf "\n  Support Namespaces (IDFY 516-519; "; prnf "%8.8Xh)",NN; prnf "     :   No"
else
   prnf "\n  Support Namespaces (IDFY 516-519; "; prnf "%8.8Xh)",NN; prnf "     :  Yes"
endif
prnf "         %d",NN
prnf "         Yes"; prnf "         %d",DellNSDefault
if (NN == 0)
   prnf "      Fail***"
   prnf "\n      +++++ Fail: The Device not support Namespace"
   prnf "\n"
   prnf "\n"
else
   if (DellNSSup == NN && DellNSDefault == NN)
      prnf "      Pass"
   else
      prnf "      Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device Namespace number less than Dell Default %d", DellNSDefault
      prnf "\n"
      prnf "\n"
   endif
endif

NVM_GETF_SEL = 0
NVM_GETF_NUMQ
idata[0] = NVM_CQE_DW0
prnf "\n  Command Queues (Get Feature Number of Queue;"; prnf " %8.8Xh)",idata[0]
if (code)
   prnf "\n     I/O Submission Queues                         :   No      NA"
   prnf "          Yes"; prnf "         %d",DellSQNum
   prnf "      NA"
   prnf "\n     I/O Completion Queues                         :   No      NA"
   prnf "          Yes"; prnf "         %d",DellCQNum
   prnf "      NA"
else
   prnf "\n     I/O Submission Queues                         :  Yes"
   CurrentNCQA = (idata[0] >> 16)
   CurrentNSQA = (idata[0]&0ffffh)
   prnf "        %2d",CurrentNSQA+1
   prnf "         Yes"; prnf "         %d",DellSQNum
   if (CurrentNSQA+1 >= DellSQNum)
      prnf "      Pass"
   else
      prnf "      Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device SQ less than Dell Deafault %d", DellSQNum
      prnf "\n"
      prnf "\n"
   endif
   prnf "\n     I/O Completion Queues                         :  Yes"
   prnf "        %2d",CurrentNCQA+1
   prnf "         Yes"; prnf "         %d",DellCQNum
   if (CurrentNCQA+1 >= DellCQNum)
      prnf "      Pass"
   else
      prnf "      Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: The Device CQ less than Dell Deafault %d", DellCQNum
      prnf "\n"
      prnf "\n"
   endif
endif

inichcs 34h,g0
g0=g0&0ffh
inichcs g0,g1
do
   g3=(g1&0ff00h)>>8
   g2=g1&0ffh
   if (g2==01h) 
      g4 = g3
   elseif (g2==05h) 
      g4 = g3
   elseif (g2==10h) 
      g4=g4+12
      inichcs g4,i0
   elseif (g2==11h) 
   endif
   inichcs (g1>>8)&0ffh,g1
   g0=g3
until (g3==0)

inichcs 100h,g1
do
   g3=g1>>20
   g2=g1&0ffffh
   if (g2==0001h)
      g4 = g3
   elseif (g2==0003h)
      g4 = g3
   elseif (g2==0004h)
      g4 = g3
   elseif (g2==000Eh)
      g4 = g3
   elseif (g2==0018h)
      g4 = g3
   elseif (g2==0019h)
      g4 = g3
   elseif (g2==001eh)
      g4=g4+4
      inichcs g4,g5
   endif
   inichcs g3,g1
   g0=g3
until (g3==0)
ASPML12Spt = (g5>>2)&01h
ASPML11Spt = (g5>>3)&01h
ASPML1Spt = (g5>>4)&01h
ASPMSpt = (i0>>22)&1
LevelASPMSpt = ((i0>>10)&02)
if (LevelASPMSpt <= 1 || ASPML12Spt == 0 || ASPML11Spt == 0 || ASPML1Spt == 0 || ASPMSpt == 0)
   prnf "\n  Support Active State Power Management            :   No"
   ASPMSUP = 0
elseif (LevelASPMSpt >= 2 && ASPML12Spt == 1 && ASPML11Spt == 1 && ASPML1Spt == 1 && ASPMSpt == 1) 
   prnf "\n  Support Active State Power Management            :  Yes"
   ASPMSUP = 1
endif
inichcs 128,i0;
ASPM = ((i0>>0)&0fh)
inichcs 392,i1;
ASPML12En = (i1>>2)&1
ASPML11En = (i1>>3)&1

if (ASPM == 0 || ASPML12En == 0 || ASPML11En == 0)
   prnf "     Disable"
   ASPMEn = 0
elseif (ASPM >= 1 && ASPML12En == 1 && ASPML11En == 1)
   prnf "      Enable"
   ASPMEn = 1
endif
if (DellASPMSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellASPMDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellASPMDefault == ASPM && ASPMSUP == DellASPMSUP)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (ASPMSUP == 1 && DellASPMSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (ASPMSUP == 0 && DellASPMSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (ASPMEn == 0 && DellASPMDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (ASPMEn == 1 && DellASPMDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif
if (ASPMSpt == 1)
   prnf "\n     ASPM Support (PXLCAP Bit 22=1)                :  Yes"
else
   prnf "\n     ASPM Support (PXLCAP Bit 22=0)                :   No"
endif
if (LevelASPMSpt == 1)
   prnf "\n     ASPM Level (PXLCAP Bit 11:10=01b)             :  Yes"
elseif (LevelASPMSpt == 2)
   prnf "\n     ASPM Level (PXLCAP Bit 11:10=10b)             :  Yes"
elseif (LevelASPMSpt == 3)
   prnf "\n     ASPM Level (PXLCAP Bit 11:10=11b)             :  Yes"
elseif (LevelASPMSpt == 0)
   prnf "\n     ASPM Level (PXLCAP Bit 11:10=00b)             :   No"
endif
if (ASPML1Spt == 1)
   prnf "\n     L1 PM Substates Supported (L1PMSCAP Bit 4=1)  :  Yes"
else
   prnf "\n     L1 PM Substates Supported (L1PMSCAP Bit 4=0)  :   No"
endif
if (ASPML11Spt == 1)
   prnf "\n     ASPM L1.1 Supported (L1PMSCAP Bit 3=1)        :  Yes"
else
   prnf "\n     ASPM L1.1 Supported (L1PMSCAP Bit 3=0)        :   No"
endif
if (ASPML12Spt == 1)
   prnf "\n     ASPM L1.2 Supported (L1PMSCAP Bit 2=1)        :  Yes"
else
   prnf "\n     ASPM L1.2 Supported (L1PMSCAP Bit 2=0)        :   No"
endif
if (ASPM == 0)
   prnf "\n     ASPM Control Enabled (PXLC Bit 1:0=00b)       :   No"
elseif (ASPM == 1)
   prnf "\n     L0s Entry Enabled (PXLC Bit 1:0=01b)          :  Yes"
elseif (ASPM == 2)
   prnf "\n     L1 Entry Enabled (PXLC Bit 1:0=10b)           :  Yes"
elseif (ASPM == 3)
   prnf "\n     L0s and L1 Entry Enabled (PXLC Bit 1:0=11b)   :  Yes"
endif
if (ASPML11En == 1)
   prnf "\n     ASPM L1.1 Enabled (L1PMSC1 Bit 3=1)           :  Yes"
else
   prnf "\n     ASPM L1.1 Enabled (L1PMSC1 Bit 3=0)           :   No"
endif
if (ASPML12En == 1)
   prnf "\n     ASPM L1.2 Enabled (L1PMSC1 Bit 2=1)           :  Yes"
else
   prnf "\n     ASPM L1.2 Enabled (L1PMSC1 Bit 2=0)           :   No"
endif

NVM_Idfy_Ctrlr
RU "ReadA",265,i0;
if (i0 == 1)
   prnf "\n  Support Auto PS Transition (IDFY 265; Bit 0=1)   :  Yes"
else
   prnf "\n  Support Auto PS Transition (IDFY 265; Bit 0=0)   :   No"
endif
NVM_GETF_SEL = 0
NVM_GETF 0Ch;
idata[0] = NVM_CQE_DW0
CurrentAPSTE = (idata[0] >> 0) & 1
if (CurrentAPSTE == 0)
   prnf "     Disable"
else
   prnf "      Enable"
endif

if (DellAPSTSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellAPSTDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellAPSTDefault == CurrentAPSTE && DellAPSTSUP == i0)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (i0 == 1 && DellAPSTSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (i0 == 0 && DellAPSTSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentAPSTE == 0 && DellAPSTDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable' (Note: This Feature maybe Enabled by BIOS)"
      prnf "\n"
      prnf "\n"
   elseif (CurrentAPSTE == 1 && DellAPSTDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable' (Note: This Feature maybe Enabled by BIOS)"
      prnf "\n"
      prnf "\n"
   endif
endif
if (CurrentAPSTE == 0)
   prnf "\n     APST (Get Feature Autonomous Power State Bit 0=0 on DW0) = Disable"
else
   prnf "\n     APST (Get Feature Autonomous Power State Bit 0=1 on DW0) =  Enable"
endif

RU "ReadA",520,i0;
ONCS = i0>>4&01h
Resersupport = i0>>5&01h
if (ONCS == 1)
   prnf "\n  Feature Persistence (IDFY 520; "; prnf "Bit 4=%X)",ONCS; prnf "          :  Yes"
else
   prnf "\n  Feature Persistence (IDFY 520; "; prnf "Bit 4=%X)",ONCS; prnf "          :   No"
endif
if (ONCS == 0)
   prnf "        NA  "
else
   prnf "        *1  "
endif
if (DellFPSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellFPDefault == 0)
   prnf "      Disable"
else
   prnf "         *1  "
endif
if (DellFPDefault == ONCS && DellFPSUP == ONCS)
   prnf "   (To Be Tested in Case 8)"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (ONCS == 1 && DellFPSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (ONCS == 0 && DellFPSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (ONCS == 0 && DellFPDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (ONCS == 1 && DellFPDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

RU "ReadA",524,i0;
CE = i0>>2&01h
SE = i0>>1&01h
if (SEDSpt == 0)
   prnf "\n  Format NVM (non-SED SSD)"
else
   prnf "\n  Format NVM (SED SSD)"
endif
if (CE == 1)
   prnf "\n     Cryptographic Erase (IDFY 524; Bit 2=1)       :  Yes"
else
   prnf "\n     Cryptographic Erase (IDFY 524; Bit 2=0)       :   No"
endif
if (CE == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (SEDSpt == 0)
   prnf "  Optional"
else
   if (DellCESUP == 0)
      prnf "        No"
   else
      prnf "       Yes"
   endif
endif
if (DellCEDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (SEDSpt == 0)
   prnf "   Pass"
else
   if (DellCEDefault == CE && DellCESUP == CE)
      prnf "   Pass"
   else
      prnf "   Fail***"
      ErrCnt+=1
      if (CE == 1 && DellCESUP == 0)
         prnf "\n      +++++ Fail: The device Value should be 'No'"
         prnf "\n"
         prnf "\n"
      elseif (CE == 0 && DellCESUP == 1)
         prnf "\n      +++++ Fail: The device Value should be 'Yes'"
         prnf "\n"
         prnf "\n"
      elseif (CE == 0 && DellCEDefault == 1)
         prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
         prnf "\n"
         prnf "\n"
      elseif (CE == 1 && DellCEDefault == 0)
         prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
         prnf "\n"
         prnf "\n"
      endif
   endif
endif
if (SE == 1)
   prnf "\n     Secure Erase (IDFY 524; Bit 1=1)              :  Yes"
else
   prnf "\n     Secure Erase (IDFY 524; Bit 1=0)              :   No"
endif
if (SE == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellSESUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellSEDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellSEDefault == SE && DellSESUP == SE)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (SE == 1 && DellSESUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (SE == 0 && DellCESUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (SE == 0 && DellSEDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (SE == 1 && DellSEDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

RU "ReadA",328,i0;
OverES = i0>>2&01h
BlockES = i0>>1&01h
CryptoES = i0>>0&01h
if (SEDSpt == 0)
   prnf "\n  Sanitize (non-SED SSD)"
else
   prnf "\n  Sanitize (SED SSD)"
endif
if (BlockES == 1)
   prnf "\n     Block Erase sanitize (IDFY 328; Bit 1=1)      :  Yes"
else
   prnf "\n     Block Erase sanitize (IDFY 328; Bit 1=0)      :   No"
endif
if (BlockES == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellBESSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellBESDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellBESDefault == BlockES && DellBESSUP == BlockES)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (BlockES == 1 && DellBESSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (BlockES == 0 && DellBESSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (BlockES == 0 && DellBESDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (BlockES == 1 && DellBESDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

if (CryptoES == 1)
   prnf "\n     Crypto Erase sanitize (IDFY 328; Bit 0=1)     :  Yes"
else
   prnf "\n     Crypto Erase sanitize (IDFY 328; Bit 0=0)     :   No"
endif
if (CryptoES == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (SEDSpt == 0)
   prnf "  Optional"
else
   if (DellCESSUP == 0)
      prnf "        No"
   else
      prnf "       Yes"
   endif
endif
if (DellCESDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (SEDSpt == 0)
   prnf "   Pass"
else
   if (DellCESDefault == CryptoES && DellCESSUP == CryptoES)
      prnf "   Pass"
   else
      prnf "   Fail***"
      ErrCnt+=1
      if (CryptoES == 1 && DellCESSUP == 0)
         prnf "\n      +++++ Fail: The device Value should be 'No'"
         prnf "\n"
         prnf "\n"
      elseif (CryptoES == 0 && DellCESSUP == 1)
         prnf "\n      +++++ Fail: The device Value should be 'Yes'"
         prnf "\n"
         prnf "\n"
      elseif (CryptoES == 0 && DellCESDefault == 1)
         prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
         prnf "\n"
         prnf "\n"
      elseif (CryptoES == 1 && DellCESDefault == 0)
         prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
         prnf "\n"
         prnf "\n"
      endif
   endif
endif

if (OverES == 1)
   prnf "\n     Overwrite sanitize (IDFY 328; Bit 2=1)        :  Yes"
else
   prnf "\n     Overwrite sanitize (IDFY 328; Bit 2=0)        :   No"
endif
if (OverES == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellOSSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellOSDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellOSDefault == OverES && DellOSSUP == OverES)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (OverES == 1 && DellOSSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (OverES == 0 && DellOSSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (OverES == 0 && DellOSDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (OverES == 1 && DellOSDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

i0=NVM_CMD_NSID
if (nvm_smart_ns==0) nvm_cmd_nsid=0ffffffffh else nvm_cmd_nsid=1 endif
NVM_GETLOG_SMART
nvm_cmd_nsid=i0
copy "ReadA","Read"
g0 = 0
SmartOffset = 0
do
   RU "ReadA", SmartOffset, Smartdata[g0]
   SmartOffset+=1
   g0+=1
until (SmartOffset == 3)
TempInfo = (Smartdata[2]<<8)+Smartdata[1]
if (TempInfo > 0)
   prnf "\n  Temperature Threshold                            :  Yes"
   TempInfo = 1
else
   prnf "\n  Temperature Threshold                            :   No"
   TempInfo = 0
endif
if (TempInfo == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellTTSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellTTDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellTTDefault == TempInfo && DellTTSUP == TempInfo)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (TempInfo == 1 && DellTTSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (TempInfo == 0 && DellTTSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (TempInfo == 0 && DellTTDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (TempInfo == 1 && DellTTDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

OverThre = 0
UnderThre = 0
NVM_CMD_NSID=0ffffffffh
NVM_GETLOG_SMART
copy "ReadA","Read"
rpoint = 200
i0=3
rrw i0;rpoint+=2
NVM_CMD_NSID = 0
nvm_getf_sel = 0
nvm_getf_tmpthld 0,0
OverThre = nvm_cqe_dw0
nvm_getf_tmpthld 1,0
UnderThre = nvm_cqe_dw0
prnf "\n     Sensor #0 Current Over/Under Temp Threshold   : "
if (OverThre == 0)
   prnf " %3.2dK", OverThre
else
   prnf " %2dC", OverThre-273
endif
if (UnderThre == 0)
   prnf "/%3.2dK", UnderThre
else
   prnf "/%2dC", UnderThre-273
endif

NVM_GETF_SEL = 0
NVM_GETF_ASYNCFG
idata[0] = NVM_CQE_DW0
CurrentSHCW = (idata[0] >> 0) & 0FFh
if (NVM_STATUS_CODE)
   prnf "\n  Asynchronous Event Config (Feature 0Bh; "; prnf "Code=%d)",NVM_STATUS_CODE; prnf "  :   No"
   i0 = 0
else
   prnf "\n  Asynchronous Event Config (Feature 0Bh; "; prnf "Code=%d)",NVM_STATUS_CODE; prnf "  :  Yes"
   i0 = 1
endif
if (CurrentSHCW == 0)
   prnf "     Disable"
else
   prnf "      Enable"
endif
if (DellAECSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellAECDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif

if (DellAECDefault <= CurrentSHCW && DellAECSUP == i0)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (i0 == 1 && DellAECSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (i0 == 0 && DellAECSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentSHCW == 0 && DellAECDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentSHCW == 1 && DellAECDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

i = 0
j = 0
do
   CriticalWarning[i] = Smartdata[0]>>j&1
   i+=1
   j+=1
until (i == 5)
if (CriticalWarning[0] == 1)
   prnf "\n     Available spare space has fallen below the threshold (Get Feature 0Bh DW0 Bit 0=1)     : Enable"
else
   prnf "\n     Available spare space has fallen below the threshold (Get Feature 0Bh DW0 Bit 0=0)     : Disable"
endif
if (CriticalWarning[1] == 1)
   prnf "\n     SSD Temperature is above or below a temperature threshold (Get Feature 0Bh DW0 Bit 1=1): Enable"
else
   prnf "\n     SSD Temperature is above or below a temperature threshold (Get Feature 0Bh DW0 Bit 1=0): Disable"
endif
if (CriticalWarning[2] == 1)
   prnf "\n     NVM subsystem reliability has been degraded (Get Feature 0Bh DW0 Bit 2=1)              : Enable"
else
   prnf "\n     NVM subsystem reliability has been degraded (Get Feature 0Bh DW0 Bit 2=0)              : Disable"
endif
if (CriticalWarning[3] == 1)
   prnf "\n     SSD media has been placed in read only mode (Get Feature 0Bh DW0 Bit 3=1)              : Enable"
else
   prnf "\n     SSD media has been placed in read only mode (Get Feature 0Bh DW0 Bit 3=0)              : Disable"
endif

NVM_GETF_SEL = 0
NVM_GETF_WRCACHE
idata[0] = NVM_CQE_DW0
CurrentDN = (idata[0] >> 0) & 0Fh
NVM_Idfy_Ctrlr
RU "ReadA",525,i0;
if (i0 == 0)
   prnf "\n  Volatile Wr Cache (IDFY 525; Bit 0=0; "; prnf "%8.8Xh)",idata[0]; prnf " :   No"
else
   prnf "\n  Volatile Wr Cache (IDFY 525; Bit 0=1; "; prnf "%8.8Xh)",idata[0]; prnf " :  Yes"
endif
if (CurrentDN == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellVWCSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellVWCDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellVWCDefault == CurrentDN && DellVWCSUP == i0)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (i0 == 1 && DellVWCSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (i0 == 0 && DellVWCSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentDN == 0 && DellVWCDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentDN == 1 && DellVWCDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif
if (CurrentDN == 0)
   prnf "\n     Volatile Write Cache Enable (Get Feature Volatile Write Cache(06h) Bit 0=0 on DW0) :  No"
else
   prnf "\n     Volatile Write Cache Enable (Get Feature Volatile Write Cache(06h) Bit 0=1 on DW0) : Yes"
endif


nvm_cmd_nsid = 1
nvm_idfy 00h
RU "ReadA",28,i0;
RU "ReadA",29,i1;
E2EInfo = (i1<<8)+i0
if (i0 == 0)
   prnf "\n  E2E Data Protect (IDFY NS Byte 28-29; "; prnf "%4.4Xh)", E2EInfo; prnf "     :   No"
else
   prnf "\n  E2E Data Protect (IDFY NS Byte 28-29; "; prnf "%4.4Xh)", E2EInfo; prnf "     :  Yes"
endif
if (i1 == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellEDPSUP == 0)
   prnf "        No"
elseif (DellEDPSUP == 1)
   prnf "       Yes"
elseif (DellEDPSUP == 2)
   prnf "        NR"
endif
if (DellEDPDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellEDPDefault == i1 && DellEDPSUP == i0)
   prnf "   Pass"
elseif (DellEDPSUP == 2)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (i0 == 1 && DellEDPSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (i0 == 0 && DellEDPSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (i1 == 0 && DellEDPDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (i1 == 1 && DellEDPDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

nvm_cmd_nsid = 0
if (Resersupport == 0)
   prnf "\n  Reservations (IDFY 520; Bit 5=0)                 :   No"
else
   prnf "\n  Reservations (IDFY 520; Bit 5=1)                 :  Yes"
endif
if (Resersupport == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellResSUP == 0)
   prnf "        No"
elseif (DellResSUP == 1)
   prnf "       Yes"
elseif (DellResSUP == 2)
   prnf "        NR"
endif
if (DellResDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellResDefault == Resersupport && DellResSUP == Resersupport)
   prnf "   Pass"
elseif (DellResSUP == 2)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (Resersupport == 1 && DellResSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (Resersupport == 0 && DellResSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (Resersupport == 0 && DellResDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (Resersupport == 1 && DellResDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

NVM_Idfy_Ctrlr
i = 272
do
   RU "ReadA",i,Datavalue[i];
   i+=1
until (i == 276)
HMB = (Datavalue[275]<<24)+(Datavalue[274]<<16)+(Datavalue[273]<<8)+Datavalue[272]
NVM_GETF_SEL = 0
NVM_GETF 0Dh;
if (HMB == 0)
   prnf "\n  Host Memory Buffer (IDFY 272-275; "; prnf "%8.8Xh)", HMB; prnf "     :   No"
else
   prnf "\n  Host Memory Buffer (IDFY 272-275; "; prnf "%8.8Xh)", HMB; prnf "     :  Yes"
endif
idata[0] = NVM_CMD_DW11
idata[1] = NVM_CMD_DW12
CurrentEHM = (idata[0] >> 0) & 0Fh
CurrentHSIZE = (idata[49] >> 0)
if (CurrentEHM == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellHMBSUP == 0)
   prnf "  Optional"
else
   prnf "       Yes"
endif
if (DellHMBDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellHMBDefault == CurrentEHM && DellHMBSUP == HMB)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (HMB == 1 && DellHMBSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (HMB == 0 && DellHMBSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentEHM == 0 && DellHMBDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentEHM == 1 && DellHMBDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

RU "ReadA",312,i0;
RU "ReadA",313,i1;
RU "ReadA",314,i2;
RU "ReadA",315,i3;
RPMBS = (i3<<24)+(i2<<16)+(i1<<8)+i0
if (i0 == 0)
   prnf "\n  Re-Protected Memory Blk(IDFY 312-315; "; prnf "%8.8Xh)", RPMBS; prnf " :   No"
else
   prnf "\n  Re-Protected Memory Blk(IDFY 312-315; "; prnf "%8.8Xh)", RPMBS; prnf " :  Yes"
endif
if (RPMBS == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellRPMBSUP == 0)
   prnf "        No"
elseif (DellRPMBSUP == 1)
   prnf "       Yes"
elseif (DellRPMBSUP == 2)
   prnf "        NR"
endif
if (DellRPMBDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellRPMBDefault == RPMBS && DellRPMBSUP == RPMBS)
   prnf "   Pass"
elseif (DellRPMBSUP == 2)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (RPMBS == 1 && DellRPMBSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (RPMBS == 0 && DellRPMBSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (RPMBS == 0 && DellRPMBDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (RPMBS == 1 && DellRPMBDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

i0=0h
i=0
do
   InNvmHba i0,Data[i];
   i0+=4
   i+=1
until (i0 == 8)
BootPar = Data[1]>>13&1
if (BootPar == 0)
   prnf "\n  Boot Partitions (NVM Reg 0-7; Bit 45=0)          :   No"
else
   prnf "\n  Boot Partitions (NVM Reg 0-7; Bit 45=1)          :  Yes"
endif
if (BootPar == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellBPSUP == 0)
   prnf "        No"
elseif (DellBPSUP == 1)
   prnf "       Yes"
elseif (DellBPSUP == 2)
   prnf "        NR"
endif
if (DellBPDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellBPDefault == BootPar && DellBPSUP == BootPar)
   prnf "   Pass"
elseif (DellBPSUP == 2)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (BootPar == 1 && DellBPSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (BootPar == 0 && DellBPSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (BootPar == 0 && DellBPDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (BootPar == 1 && DellBPDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

NVM_Idfy_Ctrlr
RU "ReadA",256,i0;
NSMgt = i0>>3&1
if (NSMgt == 0)
   prnf "\n  Namespace Management (IDFY 256; Bit 3=0)         :   No"
else
   prnf "\n  Namespace Management (IDFY 256; Bit 3=1)         :  Yes"
endif
if (NSMgt == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellNMSUP == 0)
   prnf "        No"
elseif (DellNMSUP == 1)
   prnf "       Yes"
elseif (DellNMSUP == 2)
   prnf "        NR"
endif
if (DellNMDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellNMDefault == NSMgt && DellNMSUP == NSMgt)
   prnf "   Pass"
elseif (DellNMSUP == 2)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (NSMgt == 1 && DellNMSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (NSMgt == 0 && DellNMSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (NSMgt == 0 && DellNMDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (NSMgt == 1 && DellNMDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

RU "ReadA",322,i0;
HCTM = i0>>0&1
if (HCTM == 0)
   prnf "\n  Host Controlled Thermal Mgt (IDFY 322; Bit 0=0)  :   No"
else
   prnf "\n  Host Controlled Thermal Mgt (IDFY 322; Bit 0=1)  :  Yes"
endif
if (HCTM == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellHCTMSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellHCTMDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellHCTMDefault == HCTM && DellHCTMSUP == HCTM)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (HCTM == 1 && DellHCTMSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (HCTM == 0 && DellHCTMSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (HCTM == 0 && DellHCTMDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (HCTM == 1 && DellHCTMDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

RU "ReadA",96,i0;
NOPSSpt = i0>>1&1
NVM_GETF_SEL = 0
NVM_GETF 11h;
if (NOPSSpt == 0)
   prnf "\n  Non-Operational PS Config (IDFY 96-99; Bit 1=0)  :   No"
else
   prnf "\n  Non-Operational PS Config (IDFY 96-99; Bit 1=0)  :  Yes"
endif
idata[0] = NVM_CQE_DW0
CurrentNOPPME = (idata[0] >> 0) & 0Fh
if (NOPSSpt == 0)
   prnf "        NA  "
else
   prnf "      Enable"
endif
if (DellNOPSSUP == 0)
   prnf "        No"
else
   prnf "       Yes"
endif
if (DellNOPSDefault == 0)
   prnf "      Disable"
else
   prnf "       Enable"
endif
if (DellNOPSDefault == CurrentNOPPME && DellNOPSSUP == NOPSSpt)
   prnf "   Pass"
else
   prnf "   Fail***"
   ErrCnt+=1
   if (NOPSSpt == 1 && DellNOPSSUP == 0)
      prnf "\n      +++++ Fail: The device Value should be 'No'"
      prnf "\n"
      prnf "\n"
   elseif (NOPSSpt == 0 && DellNOPSSUP == 1)
      prnf "\n      +++++ Fail: The device Value should be 'Yes'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentNOPPME == 0 && DellNOPSDefault == 1)
      prnf "\n      +++++ Fail: The device Default should be = 'Enable'"
      prnf "\n"
      prnf "\n"
   elseif (CurrentNOPPME == 1 && DellNOPSDefault == 0)
      prnf "\n      +++++ Fail: The device Default should be = 'Disable'"
      prnf "\n"
      prnf "\n"
   endif
endif

prns "\n"
prns "\n"

prns "\n Test Case 8: Dell Feature Persistence Table"
prns "\n Features                  Dell O/M   Support   Persistence      Default     Dell Persistence    Dell Default    Result   "
prns "\n ========================================================================================================================="
prnf "\n  Arbitration(01h)             M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_ARBTR
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[0] = 0
else
   prnf "      Yes"
   SptChk[0] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (idata[1] == 2)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_ARBTR
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[0] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[0] == idata[1] && DellFeaM == SptChk[0])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[0])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[0] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Power Management(02h)        M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_PWRMGT
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[1] = 0
else
   prnf "      Yes"
   SptChk[1] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[1] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_PWRMGT
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[1] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
k1 = 0
prnf "                0x%04X",k1
if (DellPersistence[1] == idata[1] && idata[0] == k1 && DellFeaM == SptChk[1])
   prnf "     Pass"
else
   prnf "     Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[1])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[1] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif


prnf "\n  Number of LBA Ranges(03h)    O  "
NVM_GETF_SEL = 3
NVM_GETF 03h;
idata[0] = NVM_CMD_DW11
if (code)
   prnf "       No"
   SptChk[2] = 0
else
   prnf "      Yes"
   SptChk[2] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[2] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 03h;
idata[0] = NVM_CMD_DW11
prnf "          %8.8x",idata[0]
if (DellPersistence[2] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (SptChk[2] == 0)
   prnf "         NA"
elseif (DellPersistence[2] == idata[1])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (idata[1] == 0 && DellPersistence[2] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif


prnf "\n  Over Temp Threshold(04h)     M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_TMPTHLD
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[3] = 0
else
   prnf "      Yes"
   SptChk[3] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[3] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_TMPTHLD
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0];prnf " (%dC)",idata[0]-273
if (DellPersistence[3] == 0)
   prnf "      No"
else
   prnf "      Yes"
endif
prnf "                VS"
if (DellPersistence[3] == idata[1] && DellFeaM == SptChk[3])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[3])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[3] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Error Recovery(05h)          M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_ERRRCVY
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[4] = 0
else
   prnf "      Yes"
   SptChk[4] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[4] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_ERRRCVY
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[4] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[4] == idata[1] && DellFeaM == SptChk[4])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[4])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[4] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Volatile Write Cache(06h)    M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_WRCACHE
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[5] = 0
else
   prnf "      Yes"
   SptChk[5] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[5] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_WRCACHE
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[5] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[5] == idata[1] && DellFeaM == SptChk[5])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[5])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[5] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Number of Queues(07h)        M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_NUMQ
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[6] = 0
else
   prnf "      Yes"
   SptChk[6] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[6] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_NUMQ
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[6] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                Max"
if (DellPersistence[6] == idata[1] && DellFeaM == SptChk[6])
   prnf "        Pass"
else
   prnf "        Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[6])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[6] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Interrupt Coalescing(08h)    M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF 08h;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[7] = 0
else
   prnf "      Yes"
   SptChk[7] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[7] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 08h;
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[7] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[7] == idata[1] && DellFeaM == SptChk[7])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[7])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[7] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Interrupt Vector Config(09h) M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF 09h;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[8] = 0
else
   prnf "      Yes"
   SptChk[8] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[8] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 09h;
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[8] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[8] == idata[1] && DellFeaM == SptChk[8])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[8])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[8] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Write Atomicity Normal(0Ah)  M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_WRATOM
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[9] = 0
else
   prnf "      Yes"
   SptChk[9] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[9] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_WRATOM
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[9] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
prnf "                VS"
if (DellPersistence[9] == idata[1] && DellFeaM == SptChk[9])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[9])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[9] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Async Event Config(0Bh)      M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF_ASYNCFG
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[10] = 0
else
   prnf "      Yes"
   SptChk[10] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[10] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF_ASYNCFG
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[10] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
k1 = 15
prnf "                0x%04X",k1
if (DellPersistence[10] == idata[1] && idata[0] == k1 && DellFeaM == SptChk[10])
   prnf "     Pass"
else
   prnf "     Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[10])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[10] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Autonomous Power State(0Ch)  M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF 0Ch;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[11] = 0
else
   prnf "      Yes"
   SptChk[11] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[11] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 0Ch;
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[11] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
k1 = 0
prnf "                0x%04X",k1
if (DellPersistence[11] == idata[1] && idata[0] == k1 && DellFeaM == SptChk[11])
   prnf "     Pass"
else
   prnf "     Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[11])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[11] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  Host Memory Buffer(0Dh)      O  "
NVM_GETF_SEL = 3
NVM_GETF 0Dh;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[12] = 0
else
   prnf "      Yes"
   SptChk[12] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[12] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 0Dh;
idata[0] = NVM_CQE_DW0
prnf "          %8.8x",idata[0]
if (DellPersistence[12] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
k1 = 0
prnf "                0x%04X",k1
if (SptChk[12] == 0)
   prnf "     NA (Feature not supported)"
elseif (DellPersistence[12] == idata[1])
   prnf "     Pass"
else
   prnf "     Fail***"
   ErrCnt+=1
   if (idata[1] == 0 && DellPersistence[12] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  HD-DITM(D4h)                 M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF 0D4h;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[13] = 0
else
   prnf "      Yes"
   SptChk[13] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[13] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 0D4h;
idata[0] = NVM_CQE_DW0
MT1Val = (idata[0]>>16)
MT2Val = (idata[0]&0ffffh)
if (MT1Val == 0)
   prnf "                NA"
else
   prnf "          %8.8X", idata[0]
   prnf " (%dC",MT1Val-273
   prnf "/%dC)",MT2Val-273
endif
if (DellPersistence[13] == 0)
   prnf "  No"
else
   prnf " Yes"
endif
prnf "                VS"
if (DellPersistence[13] == idata[1] && DellFeaM == SptChk[13])
   prnf "         Pass"
else
   prnf "         Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[13])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device not support the Feature"
      prnf "\n"
      prnf "\n"
   endif
   if (idata[1] == 0 && DellPersistence[13] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prnf "\n  SCP(D8h)                     M  "
DellFeaM = 1
NVM_GETF_SEL = 3
NVM_GETF 0D8h;
idata[0] = NVM_CQE_DW0
if (code)
   prnf "       No"
   SptChk[14] = 0
else
   prnf "      Yes"
   SptChk[14] = 1
endif
if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
   if (SptChk[14] == 0)
      prnf "         NA"
   else
      prnf "         No"
      idata[1] = 0
   endif
else
   prnf "        Yes"
   idata[1] = 1
endif
NVM_GETF_SEL = 1
NVM_GETF 0D8h;
idata[0] = NVM_CQE_DW0
if (idata[0] == 0)
   prnf "           Disable"
   i0 = 0
else
   prnf "            Enable"
   i0 = 1
endif
if (DellPersistence[14] == 0)
   prnf "            No"
else
   prnf "           Yes"
endif
k1 = 0
if (k1 == 0)
   prnf "                Disable"
else
   prnf "                 Enable"
endif
if (DellPersistence[14] == idata[1] && i0 == k1 && DellFeaM == SptChk[14])
   prnf "    Pass"
else
   prnf "    Fail***"
   ErrCnt+=1
   if (DellFeaM != SptChk[14])
      prnf "\n      +++++ Fail: The Feature is Mandatory, Device does not support the Feature"
      prnf "\n"
      prnf "\n"
   elseif (idata[1] == 0 && DellPersistence[14] == 1)
      prnf "\n      +++++ Fail: The Device Persistence should be = 'Yes'"
      prnf "\n"
      prnf "\n"
   else
      prnf "\n      +++++ Fail: The Device Persistence should be = 'No'"
      prnf "\n"
      prnf "\n"
   endif
endif

prns "\n"
prns "\n"
prns "\n Test Case 9: NVMe Controller Registers Settings"
prnf "\n                                                     Value        Dell Spec     Result   "
prnf "\n ========================================================================================"
InNvmHba 4,g0;  
MPSIMIN = ((g0>>16)&0fh)
j0 = 1
j1 = 2
do
   j1 = j1 * 2
   j0+=1
until (j0 == MPSIMIN +13)
prnf "\n  Memory Page Size Min                             : 0x%01X",MPSIMIN
prnf "          0x%01X", DellMPSMIN
if (DellMPSMIN == MPSIMIN)
   prnf "           Pass"
else
   prnf "           Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: The Device Value not follow Dell spec Value"
   prnf "\n"
   prnf "\n"
endif

INNVMHBA 8,HBAVer
NVM_Idfy_Ctrlr
RU "ReadA",77,i;

if (i == 0)
   prnf "\n  Maximum Data Transfer Size                       : %2.2Xh        ",i
else
   j0 = 1
   j1 = j1/1024
   do
      j1 = j1 * 2
      j0+=1
   until (j0 == i)
   prnf "\n  Maximum Data Transfer Size                       : %2.2Xh",i;prnf "(%dKB)",j1
endif
if (j1 > 1000)
   prnf "  06h(256KB)"
else
   prnf "   06h(256KB)"
endif
if (i == 0 || i >= 6)
   prnf "    Pass"
else
   prnf "    Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: The Device Value less than Dell spec Value"
   prnf "\n"
   prnf "\n"
endif

nvm_cmd_nsid = 1
nvm_idfy 00h
INNVMHBA 8,HBAVer
i = 0
do
   RU "ReadA",i,Datavalue[i];
   i+=1
until (i == 1409)
i0 = 0
i1 = 128
do
   LBADS[i0] = Datavalue[i1+2]
   i0+=1
   i1+=4
until (i0 == 16)
i0 = Datavalue[26] & 0fh
if (LBADS[i0] > 1) 
   k0=0
   k1=2
   do
      k1=k1*2
      k0+=1
   until (k0==LBADS[i0]-1)
elseif (LBADS[i0] == 1)
   k1=2
elseif (LBADS[i0] == 0)
   k1=0
endif
prnf "\n  Formatted LBA Size                               : 0x%01X", i0; prnf "(%dB)", k1
if (LBADS[DellFLBAS] > 1) 
   k0=0
   k1=2
   do
      k1=k1*2
      k0+=1
   until (k0==LBADS[DellFLBAS]-1)
elseif (LBADS[DellFLBAS] == 1)
   k1=2
elseif (LBADS[DellFLBAS] == 0)
   k1=0
endif
prnf "    0x%01X", DellFLBAS; prnf "(%dB)", k1
if (i0 == DellFLBAS)
   prnf "     Pass"
else
   prnf "     Fail***"
   ErrCnt+=1
   prnf "\n      +++++ Fail: The Device Value less than Dell spec Value"
   prnf "\n"
   prnf "\n"
endif

prns "\n"
prns "\n"
prns "\n Test Case 10: Test Dell Persistence Command Status (Set Feature with Default Value and Save=1)"
prns "\n Name                           Persistence   Dell Persistence   Command Status (Save=1)    Result   "
prnf "\n ===================================================================================================="
prnf "\n  Arbitration(01h)              "
nvm_cmd_nsid = 0
NVM_GETF_SEL = 3
NVM_GETF_ARBTR
idata[0] = NVM_CQE_DW0
NVM_GETF_PWRMGT
idata[1] = NVM_CQE_DW0
NVM_GETF_LBATYPE
idata[2] = NVM_CMD_DW11
NVM_GETF_TMPTHLD
idata[3] = NVM_CQE_DW0
NVM_GETF_ERRRCVY
idata[4] = NVM_CQE_DW0
NVM_GETF_WRCACHE
idata[5] = NVM_CQE_DW0
NVM_GETF_NUMQ
idata[6] = NVM_CQE_DW0
NVM_GETF_IRQCLSC
idata[7] = NVM_CQE_DW0
NVM_GETF_IRQVCFG 1
idata[8] = NVM_CQE_DW0
NVM_GETF_WRATOM
idata[9] = NVM_CQE_DW0
NVM_GETF_ASYNCFG
idata[10] = NVM_CQE_DW0
NVM_GETF_AUTOPWRT
idata[11] = NVM_CQE_DW0
NVM_GETF_HOSTBUF
idata[12] = NVM_CQE_DW0
NVM_GETF 0D4h
idata[13] = NVM_CQE_DW0
NVM_GETF 0D8h;
idata[14] = NVM_CQE_DW0
if (SptChk[0] == 0)
   prnf "    NA"
else
   if (idata[0] == 0 || idata[0] == 2 || idata[0] == 4 || idata[0] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[0] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_ARBTR
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_ARBTR 3,2,1,3
i = 0
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Power Management(02h)         "
if (SptChk[1] == 0)
   prnf "    NA"
else
   if (idata[1] == 0 || idata[1] == 2 || idata[1] == 4 || idata[1] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[1] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_PWRMGT
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_PWRMGT 1
i = 1
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Number of LBA Ranges(03h)     "
if (SptChk[2] == 0)
   prnf "    NA"
else
   if (idata[2] == 0 || idata[2] == 2 || idata[2] == 4 || idata[2] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[2] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF 03h;
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF 03h,0
i = 2
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif


prnf "\n  Over Temp Threshold(04h)      "
if (SptChk[3] == 0)
   prnf "    NA"
else
   if (idata[3] == 0 || idata[3] == 2 || idata[3] == 4 || idata[3] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[3] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_TMPTHLD
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_TMPTHLD 0
i = 3
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   if (DellPersistence[i] == 0)
      if (NVM_STATUS_CODE)
         prnf "                  Abort"
         prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
         prnf " Pass"
      else
         prnf "                  Success "
         prnf "           Fail***"
         ErrCnt+=1
         prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
         prnf "\n"
         prnf "\n"
      endif
   else
      if (NVM_STATUS_CODE)
         prnf "                  Abort"
         prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
         prnf " Fail***"
         ErrCnt+=1
         prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
         prnf "\n"
         prnf "\n"
      else
         prnf "                  Success "
         prnf "           Pass"
      endif
   endif
endif

prnf "\n  Error Recovery(05h)           "
if (SptChk[4] == 0)
   prnf "    NA"
else
   if (idata[4] == 0 || idata[4] == 2 || idata[4] == 4 || idata[4] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[4] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_ERRRCVY
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_ERRRCVY 50h
i = 4
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif


prnf "\n  Volatile Write Cache(06h)     "
if (SptChk[5] == 0)
   prnf "    NA"
else
   if (idata[5] == 0 || idata[5] == 2 || idata[5] == 4 || idata[5] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[5] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_WRCACHE
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_WRCACHE 1
i = 5
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Number of Queues(07h)         "
if (SptChk[6] == 0)
   prnf "    NA"
else
   if (idata[6] == 0 || idata[6] == 2 || idata[6] == 4 || idata[6] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[6] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_NUMQ
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF 07h, 1
i = 6
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Interrupt Coalescing(08h)     "
if (SptChk[7] == 0)
   prnf "    NA"
else
   if (idata[7] == 0 || idata[7] == 2 || idata[7] == 4 || idata[7] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[7] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_IRQCLSC
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_IRQCLSC 0,0
i = 7
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Interrupt Vector Config(09h)  "
if (SptChk[8] == 0)
   prnf "    NA"
else
   if (idata[8] == 0 || idata[8] == 2 || idata[8] == 4 || idata[8] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[8] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_IRQVCFG 1
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_IRQVCFG 1,1
i = 8
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Write Atomicity Normal(0Ah)   "
if (SptChk[9] == 0)
   prnf "    NA"
else
   if (idata[9] == 0 || idata[9] == 2 || idata[9] == 4 || idata[9] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[9] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_WRATOM
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_WRATOM 0
i = 9
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //  prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Async Event Config(0Bh)       "
if (SptChk[10] == 0)
   prnf "    NA"
else
   if (idata[10] == 0 || idata[10] == 2 || idata[10] == 4 || idata[10] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[10] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_ASYNCFG
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_ASYNCFG 1
i = 10
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Autonomous Power State(0Ch)   "
if (SptChk[11] == 0)
   prnf "    NA"
else
   if (idata[11] == 0 || idata[11] == 2 || idata[11] == 4 || idata[11] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[11] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_AUTOPWRT
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_AUTOPWRT 1
i = 11
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  Host Memory Buffer(0Dh)       "
if (SptChk[12] == 0)
   prnf "    NA"
else
   if (idata[12] == 0 || idata[12] == 2 || idata[12] == 4 || idata[12] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[12] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF_HOSTBUF
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF_HOSTBUF 1,1,0FFh
i = 12
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  HD-DITM(D4h)                  "
if (SptChk[13] == 0)
   prnf "    NA"
else
   if (idata[13] == 0 || idata[13] == 2 || idata[13] == 4 || idata[13] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[13] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF 0D4h
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_SETF 0D4h, 4Ah
i = 13
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

prnf "\n  SCP(D8h)                      "
if (SptChk[14] == 0)
   prnf "    NA"
else
   if (idata[14] == 0 || idata[14] == 2 || idata[14] == 4 || idata[14] == 6)
      prnf "    No"
      ChkPers = 0
   else
      prnf "   Yes"
      ChkPers = 1
   endif
endif
if (DellPersistence[14] == 0)
   prnf "               No"
else
   prnf "              Yes"
endif
NVM_GETF_SEL = 2
NVM_GETF 0D8h;
copy "reada","writea",0,0,512
NVM_SETF_SAVE = 1
NVM_GETF 0D8h;
i = 14
if (SptChk[i] == 0)
   prnf "                  NA"
   prnf "                 NA (Feature Not Supported)"
else
   //if (ChkPers == DellPersistence[i])
      if (DellPersistence[i] == 0)
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Pass"
         else
            prnf "                  Success "
            prnf "           Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'No', Command response should be = 'Abort'"
            prnf "\n"
            prnf "\n"
         endif
      else
         if (NVM_STATUS_CODE)
            prnf "                  Abort"
            prnf " (Status=%2.2Xh)",NVM_STATUS_CODE
            prnf " Fail***"
            ErrCnt+=1
            prnf "\n      +++++ Fail: The Dell Persistence = 'Yes', Command response should be = 'Complete'"
            prnf "\n"
            prnf "\n"
         else
            prnf "                  Success "
            prnf "           Pass"
         endif
      endif
   //else
   //   prnf "                  NA"
   //   prnf "                 NA"
   //endif
endif

hbareset
prns "\n"
prns "\n"
prns "\n Test Case 11: Dell HD-DITM Temperature Settings (+-2C)"
if (SptChk[13] == 0)
   prns "\n"
   prnf "\n      +++++ Fail: The Device not support HD-DITM, Skip"
else
   prns "\n Name           Temperature    >Temp    Command Status   <Temp    Command Status    Result   "
   prnf "\n ============================================================================================"
   prnf "\n  MT1(0:15) "
   prnf "        %dC",MT1Val-273
   TempVal[0] = MT1Val+2
   prnf "         %dC",TempVal[0]-273
   TempTest = (TempVal[0]<<16) + MT2Val
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h
   NVM_SETF_SAVE = 1
   NVM_SETF 0D4h,TempTest
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MTChk = (idata[0]>>16)
   if (MTChk == 0 || MTChk == MT1Val)
      prnf "           Abort"
      MTResult[0] = 1
   elseif (MTChk > MT1Val)
      prnf "        Success "

      MTResult[0] = 0
   endif
   TempVal[1] = MT1Val-2
   prnf "       %dC",TempVal[1]-273
   TempTest = (TempVal[1]<<16) + MT2Val
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h
   NVM_SETF_SAVE = 1
   NVM_SETF 0D4h,TempTest
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MTChk = (idata[0]>>16)
   if (MTChk == 0 || MTChk == MT1Val)
      prnf "           Abort"
      MTResult[1] = 0
   elseif (MTChk < MT1Val)
      prnf "        Success "
      MTResult[1] = 1
   endif
   if (MTResult[0] == 1 && MTResult[1] == 1)
      prnf "       Pass"
   else
      prnf "       Fail***"
      ErrCnt+=1
      if (MTResult[0] == 0 && MTResult[1] == 1)
         prnf "\n      +++++ Fail: Set Temp value greater than device temp value command response should be = 'Abort'"
         prnf "\n"
         prnf "\n"
      else
         prnf "\n      +++++ Fail: Set Temp value less than device temp value command response should be = 'Complete'"
         prnf "\n"
         prnf "\n"
      endif
   endif
   prnf "\n  MT2(16:31)"
   prnf "        %dC",MT2Val-273
   TempVal[0] = MT2Val+2
   prnf "         %dC",TempVal[0]-273
   TempTest = (TempVal[1]<<16) + TempVal[0]
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h
   NVM_SETF_SAVE = 1
   NVM_SETF 0D4h,TempTest
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MTChk = (idata[0]&0ffffh)
   if (MTChk == 0 || MTChk == MT2Val)
      prnf "           Abort"
      MTResult[0] = 1
   elseif (MTChk > MT2Val)
      prnf "        Success "
      MTResult[0] = 0
   endif
   TempVal[1] = MT2Val-2

   prnf "       %dC",TempVal[1]-273
   TempTest = (TempVal[1]<<16) + TempVal[1]
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h
   NVM_SETF_SAVE = 1
   NVM_SETF 0D4h,TempTest
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MTChk = (idata[0]>>16)
   if (MTChk == 0 || MTChk == MT2Val)
      prnf "           Abort"
      MTResult[1] = 0
   elseif (MTChk < MT2Val)
      prnf "        Success "
      MTResult[1] = 1
   endif
   if (MTResult[0] == 1 && MTResult[1] == 1)
      prnf "       Pass"
   else
      prnf "       Fail***"
      ErrCnt+=1
      if (MTResult[0] == 0 && MTResult[1] == 1)
         prnf "\n      +++++ Fail: Set Temp value greater than device temp value command response should be = 'Abort'"
         prnf "\n"
         prnf "\n"
      else
         prnf "\n      +++++ Fail: Set Temp value less than device temp value command response should be = 'Complete'"
         prnf "\n"
         prnf "\n"
      endif
   endif
   prns "\n"
   prns "\n"
   prns "\n   @SubCase 1 : Test HD-DITM Not Persistence on Power Cycle"
   prns "\n    Setp                               MT1   MT2   Result   "
   prnf "\n    ========================================================"
   prnf "\n    Default Temperature (GetF)     "
   prnf "    %dC",MT1Val-273
   prnf "   %dC",MT2Val-273
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MT1Current = (idata[0]>>16)
   MT2Current = (idata[0]&0ffffh)
   prnf "\n    Current Temperature (SetF SV=1)"
   prnf "    %dC",MT1Current-273
   prnf "   %dC",MT2Current-273
   prnf "\n    Power Cycle..."
   Pwoff
   wait 1000
   pwon
   wait 1000
   pinit
   nvm_idfy
   nvm_cmd_nsid = 0
   NVM_GETF_SEL = 0
   NVM_GETF 0D4h;
   idata[0] = NVM_CQE_DW0
   MT1Current = (idata[0]>>16)
   MT2Current = (idata[0]&0ffffh)
   prnf "\n    Current Temperature (GetF)     "
   prnf "    %dC",MT1Current-273
   prnf "   %dC",MT2Current-273
   if (MT1Current == MT1Val && MT2Current == MT2Val )
      prnf "   Pass"
   else
      prnf "   Fail***"
      ErrCnt+=1
      prnf "\n      +++++ Fail: Current Temperature should be restore to Default Temperature"
      prnf "\n"
      prnf "\n"
   endif
endif

prns "";
prns "";
prns "";
prnsr "  Script End "; date
prnsr "  Script End "; time
prns "";
prnf "\n  total number of errors   :  %d", ErrCnt
prnsr "\n  total run time           :"; prntm timer3/1000
prnf  "    (%I64u milli-seconds)\n", timer3

prns "\n"
prns "\n"
for(j0 = 1; j0 < 1000; j0+=1)
   itoa j0,10,4
   LogFile = "C:\DMTest\Chk_Info\DellSpecInfo_"+itoa+".log"
   RDFILESIZE LogFile
   if(code == 711) goto exitLogname; endif
endfor
exitLogname:
prnf "\nLog data in: "; prnf LogFile; prns ""
log LogFile

NVM_CMD_NSID = 1
upd off
echo on
end